<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Datenbanken 1 - Übungsblatt 4</title>
    <link rel="stylesheet" href="exercises.css">
    <link href="../lib/fontawesome.all.min.css" rel="stylesheet">
    <link href="../src/erd.css" rel="stylesheet">
    <link rel="stylesheet" href="../lib/joint.min.css" />
</head>
<body>
    <header>
        <div>
        <div>
            <b>Datenbanken 1 - WS 2019/20</b><br>
            Dr.-Ing. Johannes Schildgen<br>
            johannes.schildgen@h-da.de<br>
            <b>Übungsblatt 5 vom 16.12.2019, 13./14.01.2020</b>
        </div>
        <div><img src="../img/hda.png" style="border:0; height:80px"></div>
    </div>
    <hr>
    </header>
<section style="padding-top: 2.5cm">
        <h1>Aufgabe 0: SQL Island (Bonusaufgabe, 10P)</h1>
        <p>Abgabe-Deadline: 16.12.2019 12:00 im Moodle</p>
        <p>Spielen Sie das Spiel SQL Island (<a href="http://www.sql-island.de" target="_blank">http://www.sql-island.de)</a> und lassen Sie sich zum Ende des Spiels ein Zertifikat generieren. Wenn Sie die darauf befindliche Zertifikat-ID im Moodle eintragen, erhalten Sie 10 Bonuspunkte.</p>
</section>
<section>
    <h1>Aufgabe 1: SELECT-Anfragen (10P)</h1>
    <p>Abgabe-Deadline: 16.12.2019 12:00 im Moodle</p>
        <p>Auf der Webseite des Datenbankmanagementsystems Hyper können Sie SQL-Anfragen gegen das Uni-Schema aus dem Kemper-Datenbanksysteme-Buch (siehe auch Übungsblatt 3) stellen: <a href="http://hyper-db.de/interface.html" target="_blank">http://hyper-db.de/interface.html</a></p>
        <p>Professoren(<u>PersNr</u>, Name, Rang, Raum)<br>
            Studenten(<u>MatrNr</u>, Name, Semester)<br>
            Vorlesungen(<u>VorlNr</u>, Titel, SWS, gelesenVon)<br>
            hoeren(<u>MatrNr, VorlNr</u>)</p>
         <p>Vorlesungen.gelesen_von ist Fremdschlüssel auf Professoren.PersNr<br>
            hoeren.MatrNr ist Fremdschlüssel auf Studenten.MatrNr<br>
            hoeren.VorlNr ist Fremdschlüssel auf Vorlesungen.VorlNr</p>

        <p>Formulieren Sie die folgenden Anfragen mittels SQL. Jede richtige Lösung gibt 2 Punkte. Teilweise richtige Lösungen geben einen Punkt. Copy-pasten Sie einfach die SQL-Query in das Lösungfeld in Ihrer Moodle-Abgabe.</p>

        <table border="0" style="width: 100%">
        <tr><td>1.</td><td>Wie viele Professoren, die den Rang C4 haben, gibt es?</td></tr>
        <tr><td>2.</td><td>Geben Sie die Namen der Studierenden aus, die die Vorlesung &quot;Grundzüge&quot; hören, und zwar alphabetisch aufsteigend sortiert.</td></tr>
        <tr><td>3.</td><td>Geben zu jedem Professor, der mindestens zwei Vorlesungen hält, den Namen sowie die Gesamt-SWS-Zahl der von ihm oder ihr gehaltenen Vorlesungen aus. </td></tr>
        <tr><td>4.</td><td>Wie sind die Namen der Studierenden, die zusammen mit dem Studenten namens &quot;Feuerbach&quot; zumindest eine gemeinsame Vorlesung hören? Geben Sie keinen Namen doppelt aus.</td></tr>
        <tr><td>5.</td><td>Welche Professoren haben den Rang C4 und halten keine einzige 4-SWS-Vorlesung.</td></tr>
        </table>
            
    </section>

    <section style="page-break-inside:avoid; padding-top: 3cm">
    <h1>Aufgabe 2: Sichten in SQL</h1>
    <p>Auf <a href="https://data.deutschebahn.com/dataset/data-stationsdaten" target="_blank">https://data.deutschebahn.com/dataset/data-stationsdaten</a> finden Sie Datensätze mit deutschen Bahnhöfen.</p>
    <ol>
        <li>Laden Sie sich einen Datensatz im CSV-Format herunter.</li>
        <li>Betrachten Sie die Datei in einem Texteditor, welche Spalten gibt es?</li>
        <li>Erstellen Sie in Ihrer PostgreSQL-Datenbank eine Tabelle &quot;bahnhof&quot; mit den entsprechenden Spalten gemäß der CSV-Datei und wählen Sie sinnvolle Datentypen und Primärschlüssel.</li>
        <li>Benutzen Sie die Import-Funktion von DBeaver, um die CSV-Datei in Ihre Tabelle zu importieren (Rechtsklick auf die Tabelle - Daten importieren).</li>
        <li>Erstellen Sie folgende Views:
            <ol type="a">
                <li>Eine View &quot;hbf&quot; mit dem Spalten &quot;bhfnr&quot;, &quot;bundesland&quot;, &quot;station&quot; und &quot;kategorie&quot;, die alle Bahnhöfe enthält, die auf &quot;Hbf&quot; oder &quot;Hauptbahnhof&quot; enden. Die Kategorie ist lediglich eine Umbenennung der Spalte Kat. Vst.</li>
                <li>Eine View &quot;grosser_hbf&quot;, der auf der Sicht &quot;hbf&quot; basiert, aber nur die Bahnhöfe der Kategorie 1 enthält. Schreiben Sie am Ende des <code>CREATE VIEW</code>-Kommandos: <code>WITH LOCAL CHECK OPTION</code>. Dadurch wird beim Einfügen in die View das WHERE-Prädikat überprüft.</li>
            </ol>
        </li>
        <li>Formulieren Sie nun folgende Anfragen auf den Views:
                <ol type="a">
                    <li>Finden Sie den Darmstädter Hauptbahnhof</li>
                    <li>Fügen Sie in die hbf-Sicht einen neuen Bahnhof ein: &quot;Teststadt Nord&quot; in Hessen mit der ID 9999 und Kategorie 5.</li>
                    <li>Finden Sie mit einer SELECT-Anfrage auf der hbf-Sicht den neu eingefügten Bahnhof?</li>
                    <li>Löschen Sie den Bahnhof 9999 wieder aus der hbf-Sicht</li>
                    <li>Versuchen Sie das INSERT aus b) nun auf der grosser_hbf-Sicht</li>
                    <li>Passen Sie die Bahnhofskategorie so an, dass das INSERT auf der grosser_hbf-Sicht funktioniert: <code>WITH CASCADED CHECK OPTION</code></li>
                    <li>Finden Sie mit einer SELECT-Abfrage auf der grosser_hbf-Sicht den neu eingefügten Bahnhof?</li>
                    <li>Droppen Sie die grosser_hbf-Sicht und erstellen Sie sie erneut, jedoch so, dass wirklich nur Bahnhöfe in diese Sicht eingefügt werden können, die auch in der View sichtbar sind.</li>
                </ol>
        </li>
        <li>Erstellen Sie eine materialisierte Sicht &quot;Bahnhof_Statistik&quot;, die zu jedem Bundesland die Anzahl der Bahnhöfe zeigt. Wie viele Bahnhöfe zeigt diese Sicht in Hessen an? Löschen Sie Ihren Bahnhof 9999 und schauen Sie wieder in die materialiserte Sicht. Führen Sie ein <code>REFRESH</code> aus.</li>
    </ol>
    
  </section>

<script src="../lib/jquery.js"></script>
<script src="../lib/lodash.js"></script>
<script src="../lib/backbone.js"></script>
<script src="../lib/joint.min.js"></script>
<script type="text/javascript">
Reveal = document;
Reveal.registerPlugin = function(pluginname, plugin) {
    plugin.init()
};
Reveal.addEventListener = function(event, f) {
    if(event == 'ready') {
        f();
    }
}
</script>
<script type="text/javascript" src="../src/erd.js"></script>

</body>
</html>